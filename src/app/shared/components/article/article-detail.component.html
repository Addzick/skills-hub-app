<!DOCTYPE html>
<app-header [image]="'glasses'">
</app-header>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8">
            <div class="card card-primary animated fadeInLeftTiny animation-delay-5">
                <div *ngIf="!isEdit">
                    <blockquote class="blockquote">
                        <h2>{{ article.title }}</h2>
                        <p>{{ article.description }}</p>
                        <footer>
                            <a class="btn-link" [routerLink]="['/user', article.author._id ]">{{ article.author.displayName }}</a>
                            <cite class="color-medium ml-2">{{ article.updatedAt | amLocale:'fr' | amCalendar }}</cite>
                        </footer>
                        <a href="#" class="ms-tag ms-tag-info" *ngFor="let tag of article.tags">{{ tag }}</a>
                        <span class="ms-icon ms-icon-inverse color-info" *ngIf="article.nbLikes">
                            <i class="zmdi zmdi-favorite"></i>
                            {{ article.nbLikes }}
                        </span>
                        <span class="ms-icon ms-icon-inverse color-warning" *ngIf="article.nbComments">
                            <i class="zmdi zmdi-comments"></i>
                            {{ article.nbComments }}
                        </span>                        
                    </blockquote>     
                    <div class="card-block card-block-big">
                        <div [innerHtml]="article.body"></div>
                        <div class="card card-flat">
                            <div class="row justify-content-center">
                                <div class="col">
                                    <a (click)="like()" class="btn btn-info btn-block btn-raised btn-sm no-mt">
                                        <i class="zmdi zmdi-favorite no-mr"></i>
                                        <span class="d-none d-md-inline-block ml-1">J'aime</span>
                                    </a>
                                </div>
                                <div class="col">
                                    <a (click)="setCommentFormVisibility()" class="btn btn-warning btn-raised btn-block btn-sm no-mt">
                                        <i class="zmdi zmdi-comments no-mr"></i>
                                        <span class="d-none d-md-inline-block ml-1">Commenter</span>
                                    </a>
                                </div>
                                <div class="col">
                                    <a (click)="setEdit()" class="btn btn-primary btn-block btn-raised btn-sm no-mt" *ngIf="canEdit()">
                                        <i class="zmdi zmdi-edit no-mr"></i>
                                        <span class="d-none d-md-inline-block ml-1">Editer</span>
                                    </a>
                                </div>
                            </div>
                            <div class="card-footer bg-light" *ngIf="isCommentFormVisible">
                                <div class="form-group">
                                    <textarea name="comment" class="form-control" [(ngModel)]="text" placeholder="Votre commentaire ..."></textarea>
                                    <div class="pull-right">
                                        <a class="btn btn-sm btn-primary btn-raised" (click)="comment()">
                                            Commenter
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="isEdit">
                    <form [formGroup]="editForm" *ngIf="isEdit" class="m-4">
                        <fieldset>
                            <app-input 
                                [handle]="editForm.controls.title"
                                [label]="'Titre'" 
                                [errors]="{ 
                                    required: 'Un titre d\'article est requis',
                                    remote: 'Le titre d\'article est incorrect'
                                }">
                                <input type="text" formControlName="title" name="title" class="form-control">
                            </app-input>                
                            <app-input 
                                [handle]="editForm.controls.description"
                                [label]="'Description'">
                                <textarea formControlName="description" name="description" class="form-control" rows="3"></textarea>  
                            </app-input>
                            <div class="form-group row">
                                <div class="offset-md-2 col-md-10">
                                    <app-ngx-editor [config]="config"  formControlName="body" name="body" (ngModelChange)="sanitize($event)"></app-ngx-editor>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="offset-md-2 col-md-10 text-right">
                                    <button (click)="submit()" class="btn btn-raised btn-primary">
                                        Enregister
                                        <i class="zmdi zmdi-long-arrow-right no-mr ml-1"></i>
                                    </button>
                                </div>      
                            </div>
                        </fieldset>
                    </form>  
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card card-primary animated fadeInLeftTiny animation-delay-5">
                <ul class="nav nav-tabs nav-tabs-transparent indicator-primary nav-tabs-full" role="tablist">
                    <li class="nav-item"><a class="nav-link withoutripple active" href="#likes" aria-controls="likes" role="tab" data-toggle="tab"><i class="zmdi zmdi-favorite"></i> <span class="d-none d-sm-inline">J'aime</span></a></li>
                    <li class="nav-item"><a class="nav-link withoutripple" href="#comments" aria-controls="comments" role="tab" data-toggle="tab"><i class="zmdi zmdi-comments"></i> <span class="d-none d-sm-inline">Commentaire(s)</span></a></li>
                </ul>
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane fade active show" id="likes">
                        <div class="list-group">
                            <div class="list-group-item media" *ngFor="let like of likes">
                                <div class="media-left media-object media-middle">
                                    <img src="{{ like.author.image || '/assets/img/no-picture.jpg'}}" alt="{{ like.author.displayName }}" class="img-avatar-circle-sm mr-1">
                                </div>
                                <div class="media-body media-middle">
                                    <h5 class="media-title">{{ like.author.displayName }}</h5>
                                </div>
                                <div class="media-footer media-bottom text-right">
                                    <i class="zmdi zmdi-time no-mr"></i>
                                    <small>{{ like.updatedAt | amLocale:'fr' | amTimeAgo}}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane fade" id="comments">
                        <div class="list-group">
                            <div class="list-group-item media" *ngFor="let comment of comments">
                                <div class="media-left media-object media-middle">
                                    <img src="{{ comment.author.image || '/assets/img/no-picture.jpg'}}" alt="{{ comment.author.displayName }}" class="img-avatar-circle-sm mr-1">
                                </div>
                                <div class="media-body media-middle">
                                    <h5 class="media-title">{{ comment.author.displayName }}</h5>
                                    <p>{{ comment.body }}</p>
                                </div>
                                <div class="media-footer media-bottom text-right">
                                    <i class="zmdi zmdi-time no-mr"></i>
                                    <small>{{ comment.updatedAt | amLocale:'fr' | amTimeAgo}}</small>
                                </div>
                            </div>
                        </div> 
                    </div>                        
                </div>
            </div>            
        </div>
    </div>
</div>
